name: example-flow
run-name: ${{ github.actor }} is learning GitHub Actions
on: [push]
jobs:

  build:
    runs-on: ubuntu-latest
    steps:
      - name: check server-info
        run: lsb_release -a

      - name: git checkout
        run: git clone -b sample-app-0 https://github.com/nukoolmu/public-laboratory.git

      - name: docker login
        run: docker login -u nukoolm -p ${{ Secrets.DOCKER_REGISTRY }}

      - name: build and push
        run: |
          cd public-laboratory 
          ls -lrt

          docker build -f Dockerfile-appB . -t nukoolm/sample-app:github-1.0
          docker push nukoolm/sample-app:github-1.0
          
      - name: Request approval
        uses: actions/github-script@v4
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const approvers = ['nukoolmu', 'samah604'];
            const approver = approvers[0]; // Select the first approver in the list
            await github.pulls.createReviewRequest({
              owner: context.repo.owner,
              repo: context.repo.repo,
              pull_number: context.payload.pull_request.number,
              reviewers: [approver]
            });